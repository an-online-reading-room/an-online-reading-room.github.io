import{_ as q}from"../../../chunks/preload-helper-ec9aa979.js";import{S as H,i as L,s as K,e as g,t as S,k as A,c as b,a as w,h as C,d as m,m as V,b as v,g as U,H as _,j as R,M as G,V as $,w as ee,x as te,y as oe,q as j,o as O,B as ie,p as se,U as re,L as ne,v as le,n as ae}from"../../../chunks/vendor-64152532.js";import{a as ce}from"../../../chunks/leaflet-a05627c4.js";import{v as ue}from"../../../chunks/visited-f5fabbb6.js";function pe(p){let e,o,t,a,c,i,n,P,E,l,k;return{c(){e=g("section"),o=g("a"),t=g("p"),a=S(p[1]),c=A(),i=g("p"),n=S("You have already viewed this story"),P=A(),E=g("a"),l=g("button"),k=S("Visit the story again!"),this.h()},l(u){e=b(u,"SECTION",{class:!0});var r=w(e);o=b(r,"A",{href:!0});var x=w(o);t=b(x,"P",{class:!0});var z=w(t);a=C(z,p[1]),z.forEach(m),x.forEach(m),c=V(r),i=b(r,"P",{});var I=w(i);n=C(I,"You have already viewed this story"),I.forEach(m),P=V(r),E=b(r,"A",{href:!0});var N=w(E);l=b(N,"BUTTON",{class:!0});var T=w(l);k=C(T,"Visit the story again!"),T.forEach(m),N.forEach(m),r.forEach(m),this.h()},h(){v(t,"class","underline text-primary"),v(o,"href",p[2]),v(l,"class","px-3 py-2 bg-black text-white font-display"),v(E,"href",p[2]),v(e,"class","text-center font-text text-sm leading-4 bg-accent text-primary relative")},m(u,r){U(u,e,r),_(e,o),_(o,t),_(t,a),_(e,c),_(e,i),_(i,n),_(e,P),_(e,E),_(E,l),_(l,k),p[3](e)},p(u,[r]){r&2&&R(a,u[1]),r&4&&v(o,"href",u[2]),r&4&&v(E,"href",u[2])},i:G,o:G,d(u){u&&m(e),p[3](null)}}}function fe(p,e,o){let{popupElement:t}=e,{storyName:a}=e,{storyUrl:c}=e;function i(n){$[n?"unshift":"push"](()=>{t=n,o(0,t)})}return p.$$set=n=>{"popupElement"in n&&o(0,t=n.popupElement),"storyName"in n&&o(1,a=n.storyName),"storyUrl"in n&&o(2,c=n.storyUrl)},[t,a,c,i]}class he extends H{constructor(e){super();L(this,e,fe,pe,K,{popupElement:0,storyName:1,storyUrl:2})}}function W(p,e,o){const t=p.slice();return t[3]=e[o],t}function Q(p){let e,o;return{c(){e=g("p"),o=S("sorry, we could'nt find what you were looking for"),this.h()},l(t){e=b(t,"P",{class:!0});var a=w(e);o=C(a,"sorry, we could'nt find what you were looking for"),a.forEach(m),this.h()},h(){v(e,"class","font-display text-xs text-left")},m(t,a){U(t,e,a),_(e,o)},d(t){t&&m(e)}}}function B(p){let e,o,t,a;return o=new he({props:{storyUrl:"/stories/"+p[3].url,storyName:p[3].title,popupElement:this}}),{c(){e=g("div"),ee(o.$$.fragment),this.h()},l(c){e=b(c,"DIV",{id:!0});var i=w(e);te(o.$$.fragment,i),i.forEach(m),this.h()},h(){v(e,"id",t=p[3].url+"-popup-visited")},m(c,i){U(c,e,i),oe(o,e,null),a=!0},p(c,i){const n={};i&1&&(n.storyUrl="/stories/"+c[3].url),i&1&&(n.storyName=c[3].title),o.$set(n),(!a||i&1&&t!==(t=c[3].url+"-popup-visited"))&&v(e,"id",t)},i(c){a||(j(o.$$.fragment,c),a=!0)},o(c){O(o.$$.fragment,c),a=!1},d(c){c&&m(e),ie(o)}}}function de(p){let e,o,t,a,c,i,n,P,E,l,k,u,r,x,z,I,N,T=p[0],h=[];for(let s=0;s<T.length;s+=1)h[s]=B(W(p,T,s));const X=s=>O(h[s],1,1,()=>{h[s]=null});let y=null;return T.length||(y=Q()),{c(){e=g("div");for(let s=0;s<h.length;s+=1)h[s].c();y&&y.c(),o=A(),t=g("div"),a=g("p"),c=S("You have not viewed this story"),i=A(),n=g("p"),P=S("We hope you find it soon!"),E=A(),l=g("section"),k=A(),u=g("section"),r=g("p"),x=S("You have travelled "),z=S(p[1]),I=S("km on your journey"),this.h()},l(s){e=b(s,"DIV",{class:!0});var d=w(e);for(let D=0;D<h.length;D+=1)h[D].l(d);y&&y.l(d),o=V(d),t=b(d,"DIV",{id:!0,class:!0});var f=w(t);a=b(f,"P",{});var M=w(a);c=C(M,"You have not viewed this story"),M.forEach(m),i=V(f),n=b(f,"P",{});var Y=w(n);P=C(Y,"We hope you find it soon!"),Y.forEach(m),f.forEach(m),d.forEach(m),E=V(s),l=b(s,"SECTION",{id:!0,class:!0});var F=w(l);F.forEach(m),k=V(s),u=b(s,"SECTION",{class:!0});var Z=w(u);r=b(Z,"P",{});var J=w(r);x=C(J,"You have travelled "),z=C(J,p[1]),I=C(J,"km on your journey"),J.forEach(m),Z.forEach(m),this.h()},h(){v(t,"id","popup-unvisited"),v(t,"class","font-text text-sm text-primary text-center leading-4"),v(e,"class","hidden"),v(l,"id","map"),v(l,"class","h-full z-10"),v(u,"class","absolute inset-x-0 bottom-0 z-50 p-2 bg-accent text-primary font-text text-sm")},m(s,d){U(s,e,d);for(let f=0;f<h.length;f+=1)h[f].m(e,null);y&&y.m(e,null),_(e,o),_(e,t),_(t,a),_(a,c),_(t,i),_(t,n),_(n,P),U(s,E,d),U(s,l,d),U(s,k,d),U(s,u,d),_(u,r),_(r,x),_(r,z),_(r,I),N=!0},p(s,[d]){if(d&1){T=s[0];let f;for(f=0;f<T.length;f+=1){const M=W(s,T,f);h[f]?(h[f].p(M,d),j(h[f],1)):(h[f]=B(M),h[f].c(),j(h[f],1),h[f].m(e,o))}for(ae(),f=T.length;f<h.length;f+=1)X(f);se(),T.length?y&&(y.d(1),y=null):y||(y=Q(),y.c(),y.m(e,o))}(!N||d&2)&&R(z,s[1])},i(s){if(!N){for(let d=0;d<T.length;d+=1)j(h[d]);N=!0}},o(s){h=h.filter(Boolean);for(let d=0;d<h.length;d+=1)O(h[d]);N=!1},d(s){s&&m(e),re(h,s),y&&y.d(),s&&m(E),s&&m(l),s&&m(k),s&&m(u)}}}const be=async({params:p,fetch:e,session:o,stuff:t})=>({props:{stories:await(await e("/storiesapi")).json()}});function me(p,e,o){let t;ne(p,ue,i=>o(2,t=i));let{stories:a}=e,c=0;return le(async()=>{const i=(await q(()=>import("../../../chunks/leaflet-src-2497c0f6.js").then(function(l){return l.l}),["chunks/leaflet-src-2497c0f6.js","chunks/vendor-64152532.js"])).default;(await q(()=>import("../../../chunks/index-05d3ee47.js").then(function(l){return l.i}),["chunks/index-05d3ee47.js","chunks/vendor-64152532.js","chunks/leaflet-src-2497c0f6.js"])).default;let n=i.map("map").setView([20.5937,78.9629],4);i.control.scale().addTo(n),n.setMinZoom(2),n.setMaxZoom(8),i.tileLayer("https://api.mapbox.com/styles/v1/thereadingroom/ckz5ecvwu000c14pi4cc6z3kr/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidGhlcmVhZGluZ3Jvb20iLCJhIjoiY2t6NWNicmxlMHAyZzJucW9ydTNrenA0eiJ9.zQ2AECdzKcl5TrQXrGqPeA",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoidGhlcmVhZGluZ3Jvb20iLCJhIjoiY2t6NWNicmxlMHAyZzJucW9ydTNrenA0eiJ9.zQ2AECdzKcl5TrQXrGqPeA"}).addTo(n);let P=i.icon({iconUrl:"/img/story-unvisited.png",shadowUrl:"/img/story-unvisited.png",iconSize:[20,20],shadowSize:[0,0]}),E=i.icon({iconUrl:"/img/story-visited.png",shadowUrl:"/img/story-visited.png",iconSize:[20,20],shadowSize:[0,0]});fetch("/storiesapi").then(l=>l.json()).then(l=>{let k=l.map(u=>ce(u.location).then(r=>{if(r!=null){let x,z;if(t.includes(u.id)){x=`#${u.url}-popup-visited`,z=E;let I=i.popup().setLatLng([r.y,r.x]).setContent(document.querySelector(x));return i.marker({lat:r.y,lon:r.x},{icon:z}).addTo(n).bindPopup(I.getContent()),[r.y,r.x]}else{x="#popup-unvisited",z=P;let I=i.popup().setLatLng([r.y,r.x]).setContent(document.querySelector(x));i.marker({lat:r.y,lon:r.x},{icon:z}).addTo(n).bindPopup(I.getContent())}}}));return Promise.all(k)}).then(l=>{l=l.filter(u=>u!=null),i.polyline(l,{color:"black"}).addTo(n);let k=0;for(let u=0;u<l.length-1;u++){let r=l[u],x=l[u+1];k+=n.distance(r,x)}o(1,c=Math.round(k/1e3))})}),p.$$set=i=>{"stories"in i&&o(0,a=i.stories)},[a,c]}class we extends H{constructor(e){super();L(this,e,me,de,K,{stories:0})}}export{we as default,be as load};
